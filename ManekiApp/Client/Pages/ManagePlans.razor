@page "/manage-plans"
@using ManekiApp.Server.Models.ManekiAppDB
@attribute [Authorize]

<PageTitle>Manage Plans</PageTitle>
<RadzenRow>
    <RadzenColumn Size="12">
        <RadzenText Text="Manage Your Plans" TextStyle="TextStyle.H3" TagName="TagName.H1" />
    </RadzenColumn>
    
    <RadzenColumn Size="12">
        <RadzenAlert Title="Cannot update user" Shade="Shade.Lighter" Variant="Variant.Flat" Size="AlertSize.Small" AlertStyle="AlertStyle.Danger" Visible="@errorVisible" Style="border-radius: 10px; border: 1px solid #f44336">@error</RadzenAlert>
    </RadzenColumn>

    @foreach (var subscriptionView in subscriptionsList)
    {
        <RadzenColumn Size="12">
            <RadzenCard class="w-100">

                <RadzenRow>
                    <RadzenColumn Size="12" class="justify-content-between" Style="display: flex">
                        <RadzenRow>
                            <RadzenButton ButtonStyle="ButtonStyle.Light" Icon="edit" Visible="@(!subscriptionView.IsEditing)" Click="@( args => EditSubscription(subscriptionView))"></RadzenButton>
                            <RadzenButton ButtonStyle="ButtonStyle.Success" Icon="check" Visible="@(subscriptionView.IsEditing)" Click="@( args => UpdateSubscription(subscriptionView))"></RadzenButton>
                            <RadzenButton ButtonStyle="ButtonStyle.Danger" Icon="clear" Visible="@(subscriptionView.IsEditing)" Click="@( args => DiscardChanges(subscriptionView))"></RadzenButton>
                        </RadzenRow>
                        <RadzenRow>
                            <RadzenText Style="text-align: center; display: flex; align-items:center;">Subscription Level</RadzenText>
                            <RadzenBadge Style="text-align: center; display: flex; align-items: center; font-family: Verdana; font-weight: 500; font-size: 16px; background-color: #3994ff" class="rz-px-3">@subscriptionView.Subscription.PermissionLevel</RadzenBadge>
                        </RadzenRow>
                    </RadzenColumn>
                </RadzenRow>
                
                <hr style="border: none; background-color: rgba(0,0,0,.2); height: 1px; margin: 1rem 0;" />
                
                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center">
                    <RadzenRow class="w-100">
                        <RadzenColumn class="flex-column justify-content-center" Style="display: flex">
                            <RadzenStack Gap="0">
                                <RadzenText TextStyle="TextStyle.Overline" class="rz-display-flex rz-mt-2 rz-my-0">Title</RadzenText>
                                <RadzenText Style="font-weight: 400" Visible="@(!subscriptionView.IsEditing)"><b>@subscriptionView.Subscription.Title</b></RadzenText>
                                <RadzenTextBox Placeholder="Subscription Title" @bind-Value="@subscriptionView.Subscription.Title" Visible="@(subscriptionView.IsEditing)"></RadzenTextBox>
                            </RadzenStack>
                            <RadzenStack Gap="0">
                                <RadzenText TextStyle="TextStyle.Overline" class="rz-display-flex rz-mt-2 rz-my-0">Price</RadzenText>
                                <RadzenText Style="font-weight: 400" Visible="@(!subscriptionView.IsEditing)">@subscriptionView.Subscription.Price $</RadzenText>
                                
                                <RadzenStack Orientation="Orientation.Horizontal" Visible="@(subscriptionView.IsEditing)">
                                    <RadzenNumeric TValue="decimal" Step="0.1" Placeholder="Subscription Price" class="w-100" @bind-Value="@subscriptionView.Subscription.Price"></RadzenNumeric>
                                    <RadzenColumn>
                                        <RadzenText class="align-items-center h-100 rz-px-3" Style="display: flex; font-size: 20px; font-weight: 500">$</RadzenText>
                                    </RadzenColumn>
                                </RadzenStack>
                            </RadzenStack>
                        </RadzenColumn>

                        <RadzenColumn class="flex-column justify-content-center" Style="display: flex" SizeMD="6">
                            <RadzenStack Gap="0" Style="height: 100%" >
                                <RadzenText TextStyle="TextStyle.Overline" class="rz-display-flex rz-mt-2 rz-my-0">Description</RadzenText>
                                <RadzenText Style="font-weight: 400; word-break:break-all;" class="h-100" Visible="@(!subscriptionView.IsEditing)">@subscriptionView.Subscription.Description</RadzenText>
                                <RadzenTextArea Placeholder="Subscription Description" @bind-Value="@subscriptionView.Subscription.Description" Style="height: 100%" Visible="@(subscriptionView.IsEditing)"></RadzenTextArea>
                            </RadzenStack>
                        </RadzenColumn>
                    </RadzenRow>
                </RadzenStack>
            </RadzenCard>
        </RadzenColumn>    
    }

</RadzenRow>
